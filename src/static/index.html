<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini Playground - API 测试工具</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <link rel="stylesheet" href="css/style.css">
    <script src="js/auth.js"></script>
</head>
<body>
    <div id="app">
        <!-- 顶部导航栏 -->
        <header class="app-header">
            <h1>Gemini Playground</h1>
            <div class="header-actions">
                <button id="logout-btn" class="icon-btn" title="登出">
                    <span class="material-symbols-outlined">logout</span>
                </button>
            </div>
        </header>

        <!-- 标签页导航 -->
        <nav class="tab-nav">
            <button class="tab-btn active" data-tab="chat">
                <span class="material-symbols-outlined">chat</span>
                聊天测试
            </button>
            <button class="tab-btn" data-tab="logs">
                <span class="material-symbols-outlined">terminal</span>
                请求日志
            </button>
            <button class="tab-btn" data-tab="settings">
                <span class="material-symbols-outlined">settings</span>
                设置
            </button>
            <button class="tab-btn" data-tab="api-keys">
                <span class="material-symbols-outlined">key</span>
                API 管理
            </button>
        </nav>

        <!-- 标签页内容 -->
        <div class="tab-content">
            <!-- 聊天标签页 -->
            <div id="chat-tab" class="tab-pane active">
                <div class="chat-container">
                    <!-- 聊天消息区域 -->
                    <div id="chat-messages" class="chat-messages">
                        <div class="welcome-message">
                            <h2>欢迎使用 Gemini API 测试工具</h2>
                            <p>请在下方输入消息开始测试</p>
                        </div>
                    </div>

                    <!-- 输入区域 -->
                    <div class="chat-input-area">
                        <div class="input-controls">
                            <input type="text" id="message-input" placeholder="输入消息..." />
                            <button id="send-button" class="primary-btn">
                                <span class="material-symbols-outlined">send</span>
                            </button>
                            <button id="mic-button" class="icon-btn">
                                <span id="mic-icon" class="material-symbols-outlined">mic</span>
                            </button>
                            <button id="camera-button" class="icon-btn">
                                <span id="camera-icon" class="material-symbols-outlined">videocam</span>
                            </button>
                            <button id="screen-button" class="icon-btn">
                                <span id="screen-icon" class="material-symbols-outlined">screen_share</span>
                            </button>
                        </div>
                    </div>

                    <!-- 音频可视化 -->
                    <div class="audio-visualizers" style="display: none;">
                        <div class="visualizer-container">
                            <label>输入音频</label>
                            <div id="input-audio-visualizer"></div>
                        </div>
                        <div class="visualizer-container">
                            <label>输出音频</label>
                            <div id="audio-visualizer"></div>
                        </div>
                    </div>

                    <!-- 视频预览 -->
                    <div id="video-container" style="display: none;">
                        <video id="preview" playsinline autoplay muted></video>
                        <div class="video-controls">
                            <button id="stop-video">停止视频</button>
                            <button id="flip-camera">
                                <span class="material-symbols-outlined">flip_camera_ios</span>
                            </button>
                        </div>
                    </div>

                    <!-- 屏幕共享预览 -->
                    <div id="screen-container" style="display: none;">
                        <video id="screen-preview" playsinline autoplay muted></video>
                        <button class="close-button material-symbols-outlined">close</button>
                    </div>
                </div>
            </div>

            <!-- 请求日志标签页 -->
            <div id="logs-tab" class="tab-pane">
                <div class="logs-container">
                    <div class="logs-header">
                        <h2>API 请求日志</h2>
                        <button id="clear-logs" class="secondary-btn">
                            <span class="material-symbols-outlined">delete</span>
                            清空日志
                        </button>
                    </div>
                    <div id="logs-list" class="logs-list">
                        <div class="empty-logs">
                            <span class="material-symbols-outlined">info</span>
                            <p>暂无请求日志</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 设置标签页 -->
            <div id="settings-tab" class="tab-pane">
                <div class="settings-container">
                    <h2>API 设置</h2>
                    
                    <div class="settings-section">
                        <h3>基本设置</h3>
                        <div class="setting-item">
                            <label for="api-key">验证令牌 (Auth Token)</label>
                            <input type="password" id="api-key" placeholder="请输入验证令牌" />
                            <small>⚠️ 注意：这里需要输入验证令牌，不是 API Key。<a href="/AUTH_TOKEN_GUIDE.md" target="_blank">查看如何获取验证令牌</a></small>
                        </div>

                        <div class="setting-item">
                            <label for="api-format-select">API 格式</label>
                            <select id="api-format-select">
                                <option value="openai">OpenAI 格式</option>
                                <option value="gemini" selected>Gemini 原生格式</option>
                            </select>
                        </div>

                        <div class="setting-item">
                            <label for="model-select">模型选择</label>
                            <select id="model-select">
                                <option value="gemini-2.5-pro">gemini-2.5-pro (默认)</option>
                                <option value="gemini-2.5-flash">gemini-2.5-flash</option>
                                <option value="gemini-1.5-pro">gemini-1.5-pro</option>
                                <option value="gemini-1.5-flash">gemini-1.5-flash</option>
                            </select>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>语音设置</h3>
                        <div class="setting-item">
                            <label for="language-select">语言</label>
                            <select id="language-select"></select>
                        </div>

                        <div class="setting-item">
                            <label for="voice-select">声音</label>
                            <select id="voice-select">
                                <option value="Puck">Puck (男声)</option>
                                <option value="Charon">Charon (男声)</option>
                                <option value="Fenrir">Fenrir (男声)</option>
                                <option value="Kore">Kore (女声)</option>
                                <option value="Aoede" selected>Aoede (女声)</option>
                            </select>
                        </div>

                        <div class="setting-item">
                            <label for="response-type-select">响应类型</label>
                            <select id="response-type-select">
                                <option value="text">文本</option>
                                <option value="audio" selected>音频</option>
                            </select>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>视频设置</h3>
                        <div class="setting-item">
                            <label for="fps-input">视频 FPS</label>
                            <input type="number" id="fps-input" value="1" min="1" max="30" step="1"/>
                            <small>更高的 FPS 需要更多网络带宽</small>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3>系统指令</h3>
                        <div class="setting-item">
                            <textarea id="system-instruction" placeholder="输入自定义系统指令..." rows="6"></textarea>
                        </div>
                    </div>

                    <div class="settings-actions">
                        <button id="apply-config" class="primary-btn">保存设置</button>
                        <button id="connect-button" class="secondary-btn">连接 WebSocket</button>
                    </div>
                    
                    <!-- 连接诊断信息 -->
                    <div id="connection-info" class="settings-section" style="display: none;">
                        <h3>连接诊断信息</h3>
                        <div class="connection-details">
                            <div class="info-item">
                                <strong>连接状态：</strong>
                                <span id="connection-status">未连接</span>
                            </div>
                            <div class="info-item">
                                <strong>WebSocket URL：</strong>
                                <span id="ws-url">-</span>
                            </div>
                            <div class="info-item">
                                <strong>使用的令牌类型：</strong>
                                <span id="token-type">-</span>
                            </div>
                            <div class="info-item">
                                <strong>API 格式：</strong>
                                <span id="api-format-info">-</span>
                            </div>
                            <div class="info-item">
                                <strong>模型：</strong>
                                <span id="model-info">-</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- API 管理标签页 -->
            <div id="api-keys-tab" class="tab-pane">
                <div class="api-management-container">
                    <div class="management-section">
                        <h2>API Key 管理</h2>
                        <div class="api-keys-list" id="api-keys-list"></div>
                        <div class="add-form">
                            <input type="password" id="new-api-key" placeholder="输入新的 API Key" />
                            <button id="add-api-key" class="primary-btn">添加</button>
                        </div>
                    </div>

                    <div class="management-section">
                        <h2>验证令牌管理</h2>
                        <div class="auth-tokens-list" id="auth-tokens-list"></div>
                        <div class="add-form">
                            <input type="password" id="new-auth-token" placeholder="输入新的验证令牌" />
                            <button id="add-auth-token" class="primary-btn">添加</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/main-new.js" type="module"></script>
</body>
</html>
